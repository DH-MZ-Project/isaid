// utils/etfPersonality.ts

// 1. 리스크 성향 판단 (Q1~Q6 기준)
export const getRiskType = (answers: (number | null)[] = []): string => {
  if (!Array.isArray(answers) || answers.length < 6) return '안정형';

  const score = answers
    .slice(0, 6)
    .map((v) => v ?? 0)
    .reduce((acc, v) => acc + v, 0);

  if (score <= 6) return '안정형';
  if (score <= 10) return '안정추구형';
  if (score <= 15) return '위험중립형';
  if (score <= 20) return '적극투자형';
  return '공격투자형';
};

// 2. ETF 분류체계별 임팩트/해시태그 정보
const etfMetaMap: Record<
  string,
  { impact: string; hashtags: string[]; description: string }
> = {
  '주식-전략-성장': {
    impact: '🚀 미래 먹거리 픽!',
    hashtags: ['#성장주', '#미래유망기업', '#고성장'],
    description:
      '성장 전략 ETF는 기술, 헬스케어, 신재생에너지 등 미래 성장 가능성이 높은 산업과 기업에 투자합니다. 빠른 매출 성장과 높은 주가 상승을 기대하며, 장기적 관점에서 수익률을 추구하는 투자자에게 적합합니다.',
  },
  '주식-전략-가치': {
    impact: '🧠 저평가 헌터',
    hashtags: ['#가치주', '#저평가기업', '#내재가치'],
    description:
      '가치 전략 ETF는 현재 저평가된 기업에 투자하여, 주가가 내재가치에 수렴할 때 수익을 얻는 것을 목표로 합니다. 일반적으로 배당을 지급하거나 실적이 안정적인 기업들로 구성되며, 보수적이고 합리적인 투자 성향에 맞습니다.',
  },
  '주식-전략-배당': {
    impact: '💰 꾸준수익러',
    hashtags: ['#배당주', '#정기수익', '#현금흐름'],
    description:
      '배당 전략 ETF는 꾸준히 배당을 지급하는 기업을 중심으로 구성되며, 정기적인 현금 흐름을 제공합니다. 안정적인 수익을 원하는 투자자에게 적합하며, 은퇴 준비나 장기 투자에 활용됩니다.',
  },
  '주식-전략-전략테마': {
    impact: '🔥 이슈픽 투자',
    hashtags: ['#테마ETF', '#산업트렌드', '#포커스전략'],
    description:
      '전략테마 ETF는 특정 산업 트렌드나 이슈에 따라 포커스된 투자를 지향합니다. AI, 메타버스, ESG 등 시장에서 주목받는 키워드에 집중하며, 시의성 있는 수익 기회를 추구하는 성향에 적합합니다.',
  },
  '주식-전략-혼합/퀀트': {
    impact: '📊 알고리즘 감성',
    hashtags: ['#퀀트전략', '#알고리즘ETF', '#모델기반'],
    description:
      '혼합/퀀트 전략 ETF는 다양한 요인을 통합하거나 정량적 모델을 기반으로 포트폴리오를 구성합니다. 데이터 중심의 투자 판단을 중시하는 분석형 투자자에게 어울립니다.',
  },
  '주식-전략-구조화': {
    impact: '🎲 하이브리드 투자',
    hashtags: ['#파생ETF', '#구조화상품', '#고급전략'],
    description:
      '구조화 전략 ETF는 파생상품이나 옵션 등을 활용하여 수익 구조를 조정하는 상품입니다. 복잡한 구조지만 특정 리스크나 수익률을 타깃으로 하는 전략을 취합니다.',
  },
  '주식-전략-변동성': {
    impact: '⚡ 고위험 감당러',
    hashtags: ['#변동성조절', '#리스크관리', '#방어전략'],
    description:
      '변동성 전략 ETF는 시장의 변동을 활용하거나 회피하는 전략을 취합니다. 위험을 적극적으로 다루거나 안정성을 추구하는 데 활용됩니다.',
  },
  '주식-시장대표': {
    impact: '🏛 시장 따라가는 무빙러',
    hashtags: ['#시장지수', '#KOSPI', '#S&P500'],
    description:
      '시장대표 ETF는 KOSPI, S&P500과 같은 대표 지수를 추종합니다. 전체 시장의 흐름을 따르며, 분산 투자와 평균 수익률을 추구하는 기본 포트폴리오 구성에 적합합니다.',
  },
  '주식-업종섹터': {
    impact: '🧭 섹터의 넓은 시야',
    hashtags: ['#업종ETF', '#섹터전략', '#분산투자'],
    description:
      '업종섹터 ETF는 다양한 산업군에 분산 투자하는 상품입니다. 특정 섹터에 의존하지 않고 산업 전반을 포괄하는 관점에서 투자하고자 할 때 사용됩니다.',
  },
  '주식-업종섹터-정보기술': {
    impact: '🤖 반도체=로망',
    hashtags: ['#IT섹터', '#반도체', '#AI플랫폼'],
    description:
      '정보기술 섹터 ETF는 반도체, 소프트웨어, 인공지능 등 기술 중심 기업에 집중합니다. 혁신과 미래 성장성을 중시하는 성향에 적합합니다.',
  },
  '주식-업종섹터-헬스케어': {
    impact: '⚕️ 헬시코인 좋아함',
    hashtags: ['#바이오', '#의료산업', '#헬스케어'],
    description:
      '헬스케어 ETF는 제약, 바이오, 의료기기 등 건강 산업에 투자합니다. 치유와 회복 중심의 안정적 성향과도 연결됩니다.',
  },
  '주식-업종섹터-금융': {
    impact: '💳 금알못 탈출러',
    hashtags: ['#금융주', '#은행보험', '#이자수익'],
    description:
      '금융 ETF는 은행, 보험, 증권 등 금융업종에 투자합니다. 금리에 민감하며, 보수적인 성향의 투자자에게 적합합니다.',
  },
  '주식-업종섹터-에너지화학': {
    impact: '🔋 전기차 러버',
    hashtags: ['#전기차', '#배터리', '#석유화학'],
    description:
      '에너지 및 화학 ETF는 석유, 배터리, 신재생에너지 등 원자재 기반 산업에 투자합니다. 글로벌 자원 수요에 민감하고, 실물경제 기반 성향에 적합합니다.',
  },
  '주식-업종섹터-경기소비재': {
    impact: '🛍 요즘잇템 감별사',
    hashtags: ['#자동차', '#패션뷰티', '#소비회복'],
    description:
      '경기소비재 ETF는 자동차, 패션, 여행 등 소비자 지출이 많은 산업에 투자합니다. 소비 트렌드에 민감한 성향에 적합합니다.',
  },
  '주식-업종섹터-생활소비재': {
    impact: '🧼 생활템 모으는 투자',
    hashtags: ['#생필품', '#식품음료', '#생활필수'],
    description:
      '생활소비재 ETF는 식품, 생활용품 등 필수 소비재 중심입니다. 경기에 덜 민감하며, 안정적인 수요를 가진 산업에 투자합니다.',
  },
  '주식-업종섹터-건설': {
    impact: '🏗️ 인프라 덕후',
    hashtags: ['#건설주', '#인프라', '#부동산개발'],
    description:
      '건설 ETF는 인프라, 건설, 부동산 관련 기업에 투자합니다. 경기 회복과 개발에 대한 기대감이 반영됩니다.',
  },
  '주식-업종섹터-중공업': {
    impact: '⚙ 묵직한 실물파',
    hashtags: ['#조선기계', '#산업설비', '#제조업'],
    description:
      '중공업 ETF는 조선, 기계, 중장비 산업에 투자합니다. 실물 기반 대형 산업을 선호하는 성향과 맞습니다.',
  },
  '주식-업종섹터-커뮤니케이션서비스': {
    impact: '📱 SNS=투자영감',
    hashtags: ['#SNS', '#엔터테인먼트', '#미디어'],
    description:
      '커뮤니케이션 ETF는 SNS, 미디어, 엔터테인먼트 등 정보 전달 산업에 집중합니다. 온라인 기반의 트렌디한 성향에 적합합니다.',
  },
  '주식-업종섹터-산업재': {
    impact: '🛠 산업의 근본 투자',
    hashtags: ['#기계설비', '#중간재', '#인프라기초'],
    description:
      '산업재 ETF는 기계, 중간재 등 생산 기반의 산업에 투자합니다. 안정성과 실용적 성향을 가진 투자자에게 어울립니다.',
  },
  '주식-업종섹터-철강소재': {
    impact: '🔩 산업기초 믿는 타입',
    hashtags: ['#철강주', '#원자재', '#기초소재'],
    description:
      '철강 및 소재 ETF는 원자재와 산업 기초 자재에 투자합니다. 실물경제와 가치 중심 성향과 연결됩니다.',
  },
  '주식-업종섹터-업종테마': {
    impact: '🔎 테마에 진심',
    hashtags: ['#섹터집중', '#산업분류기반', '#테마베팅'],
    description:
      '업종테마 ETF는 산업 내 세부 테마에 집중하는 전략입니다. 특정 산업 트렌드에 민감하고 집중 투자 성향을 지닌 투자자에게 적합합니다.',
  },
  '주식-전략-기업그룹': {
    impact: '🏙 그룹사 묶음픽',
    hashtags: ['#그룹ETF', '#지주사중심', '#재벌계열'],
    description:
      '기업그룹 ETF는 동일 그룹 내 계열사를 묶어 투자합니다. 지배구조, 경영 안정성, 시너지 효과를 고려하는 투자자에게 어울립니다.',
  },
  '주식-규모-대형주': {
    impact: '🏢 대기업=든든',
    hashtags: ['#대형주', '#시가총액상위', '#시장대표'],
    description:
      '대형주 ETF는 삼성전자 등 시가총액 상위 종목을 포함합니다. 시장 안정성과 신뢰도를 중시하는 성향에 적합합니다.',
  },
  '주식-규모-중형주': {
    impact: '🚀 중소형 잠재주 픽!',
    hashtags: ['#중형주', '#성장잠재력', '#핵심신흥주'],
    description:
      '중형주 ETF는 일정 규모 이상의 성장주에 투자합니다. 대형주는 아니지만 높은 잠재력을 가진 기업을 선호하는 성향입니다.',
  },
  혼합자산: {
    impact: '⚖️ 분산은 진리',
    hashtags: ['#자산혼합', '#분산투자', '#멀티에셋'],
    description:
      '혼합자산 ETF는 주식, 채권, 현금 등을 혼합해 구성합니다. 리스크 분산과 안정성 중심의 전략을 원하는 투자자에게 적합합니다.',
  },
  '혼합자산-주식+채권': {
    impact: '🧘 리스크 반반무많이',
    hashtags: ['#주식채권믹스', '#리스크중립', '#기본포트폴리오'],
    description:
      '주식과 채권을 반반 섞은 ETF로, 안정성과 수익성을 균형 있게 고려한 전략입니다. 투자 초보나 안정적 성향의 투자자에게 인기가 있습니다.',
  },
};

// 3. 메타정보 추출 함수
const getMetaForType = (name: string) =>
  etfMetaMap[name] || { impact: '✨ 설명 준비중', hashtags: ['#ETF'] };

// 4. 질문 번호 ~ 선택지에 따른 분류체계/이유 매핑
const questionReasonMap: Record<
  number,
  Record<number, { types: string[]; reason: string }>
> = {
  6: {
    0: {
      types: ['혼합자산-주식+채권', '주식-업종섹터'],
      reason: '책임감 있고 안정감을 중요시하셨어요 (Q7).',
    },
    1: {
      types: ['주식-업종섹터-업종테마', '주식-전략-성장'],
      reason: '트렌드에 민감하고 빠르게 움직이는 스타일이시군요 (Q7).',
    },
    2: {
      types: ['주식-전략-전략테마', '주식-전략-혼합/퀀트'],
      reason: '몰입형 성향을 갖고 계셨어요 (Q7).',
    },
  },
  7: {
    0: {
      types: ['주식-규모-대형주', '주식-전략-배당'],
      reason: '안정적이고 여유 있는 일상을 선호하셨어요 (Q8).',
    },
    1: {
      types: ['주식-업종섹터-건설', '주식-업종섹터-커뮤니케이션서비스'],
      reason: '도시 기반 산업과 트렌디한 경험을 중요하게 보셨어요 (Q8).',
    },
    2: {
      types: ['주식-업종섹터-생활소비재', '주식-시장대표'],
      reason: '꾸준하고 몰입형 라이프스타일을 선호하셨군요 (Q8).',
    },
  },
  8: {
    0: {
      types: ['주식-전략-가치', '주식-업종섹터-금융'],
      reason: '실용성과 현실적인 콘텐츠에 관심이 많으셨어요 (Q9).',
    },
    1: {
      types: ['주식-업종섹터-정보기술', '주식-전략-성장'],
      reason: '미래 기술과 혁신에 관심이 높으셨어요 (Q9).',
    },
    2: {
      types: ['주식-업종섹터-생활소비재', '혼합자산'],
      reason: '일상과 편안한 라이프에 가치를 두셨군요 (Q9).',
    },
  },
  9: {
    0: {
      types: ['주식-시장대표', '주식-규모-대형주'],
      reason: '검증된 안정성과 신뢰를 중요하게 여기셨어요 (Q10).',
    },
    1: {
      types: ['주식-전략-전략테마', '주식-업종섹터-정보기술'],
      reason: '혁신과 트렌드에 민감하셨어요 (Q10).',
    },
    2: {
      types: ['주식-전략-가치', '주식-전략-혼합/퀀트'],
      reason: '분석적이고 철저한 성향을 보여주셨어요 (Q10).',
    },
  },
  10: {
    0: {
      types: ['주식-업종섹터-헬스케어', '혼합자산-주식+채권'],
      reason: '편안함과 치유 중심의 콘텐츠를 선호하셨어요 (Q11).',
    },
    1: {
      types: ['주식-업종섹터-에너지화학', '주식-업종섹터-철강소재'],
      reason: '실물경제 기반의 현실성 있는 시각을 보여주셨어요 (Q11).',
    },
    2: {
      types: ['주식-전략-변동성', '주식-전략-구조화'],
      reason: '리스크와 박진감 있는 선택을 하셨네요 (Q11).',
    },
  },
  11: {
    0: {
      types: ['주식-규모-중형주', '주식-업종섹터-커뮤니케이션서비스'],
      reason: '성장 가능성과 온라인 기반 활동을 추구하셨어요 (Q12).',
    },
    1: {
      types: ['주식-업종섹터-중공업', '주식-업종섹터-산업재'],
      reason: '꾸준하고 장기적인 성과를 중시하셨어요 (Q12).',
    },
    2: {
      types: ['주식-업종섹터-업종테마', '주식-업종섹터-경기소비재'],
      reason: '트렌디한 소비와 취향 확장을 선호하셨어요 (Q12).',
    },
  },
  12: {
    0: {
      types: ['주식-전략-혼합/퀀트', '주식-전략-배당'],
      reason: '분석적 사고와 안정감을 중시하셨어요 (Q13).',
    },
    1: {
      types: ['주식-전략-성장', '주식-업종섹터-정보기술'],
      reason: '미래 지향적인 창의성과 트렌드에 열려 있으셨어요 (Q13).',
    },
    2: {
      types: ['혼합자산', '주식-업종섹터-헬스케어'],
      reason: '회복과 조화를 중요시하는 성향이셨네요 (Q13).',
    },
  },
  13: {
    0: {
      types: ['주식-전략-기업그룹', '혼합자산-주식+채권'],
      reason: '안정성과 균형을 동시에 추구하셨어요 (Q14).',
    },
    1: {
      types: ['주식-전략-변동성', '주식-규모-중형주'],
      reason: '모험과 기회를 적극적으로 추구하셨어요 (Q14).',
    },
    2: {
      types: ['주식-전략-가치', '주식-업종섹터-철강소재'],
      reason: '가치 중심의 현실적 판단력을 보이셨어요 (Q14).',
    },
  },
  14: {
    0: {
      types: ['주식-전략-기업그룹', '주식-업종섹터-경기소비재'],
      reason: '협업과 그룹 내 활동을 중시하셨어요 (Q15).',
    },
    1: {
      types: ['주식-업종섹터-금융', '주식-전략-구조화'],
      reason: '금융 데이터와 복잡한 전략 구조에 강점을 보이셨어요 (Q15).',
    },
    2: {
      types: ['주식-업종섹터-산업재', '주식-업종섹터-중공업'],
      reason: '제조와 실물 기반의 프로젝트형 성향이셨어요 (Q15).',
    },
  },
  15: {
    0: {
      types: ['주식-업종섹터', '주식-업종섹터-건설'],
      reason: '산업 전반과 인프라 기반 시야를 갖고 계셨어요 (Q16).',
    },
    1: {
      types: ['주식-업종섹터-에너지화학', '주식-업종섹터-철강소재'],
      reason: '실물 경제와 원자재 기반 가치를 중시하셨어요 (Q16).',
    },
    2: {
      types: ['주식-전략-구조화', '주식-업종섹터-중공업'],
      reason: '리스크 기반 차별화 전략에 끌리셨어요 (Q16).',
    },
  },
};

// 5. 최종 추천 타입 추출 함수 (count + reason + meta 통합)
export const getRecommendedTypesWithReasons = (
  answers: (number | null)[]
): {
  description: string;
  name: string;
  reason: string[];
  impact: string;
  hashtags: string[];
}[] => {
  if (!Array.isArray(answers) || answers.length < 16) return [];

  const counts: Record<string, number> = {};
  const reasonsMap: Record<string, string[]> = {};

  for (let i = 6; i <= 15; i++) {
    const answer = answers[i];
    if (answer == null) continue;

    const qMap = questionReasonMap[i];
    const entry = qMap?.[answer];
    if (!entry) continue;

    entry.types.forEach((type) => {
      counts[type] = (counts[type] || 0) + 1;
      if (!reasonsMap[type]) reasonsMap[type] = [];
      if (!reasonsMap[type].includes(entry.reason)) {
        reasonsMap[type].push(entry.reason);
      }
    });
  }

  return Object.entries(counts)
    .sort((a, b) => b[1] - a[1])
    .slice(0, 3)
    .map(([name]) => ({
      name,
      reason: reasonsMap[name] ?? ['-'], // ✅ 배열로 유지
      ...getMetaForType(name),
    }));
};
